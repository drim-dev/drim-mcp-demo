# План реализации MCP Demo

## Актуальные версии (февраль 2026)

| Инструмент | Версия | Примечания |
|---|---|---|
| Next.js | 16.1.6 | App Router, Turbopack stable |
| Prisma | 7.3.0 | Rust-free архитектура |
| Tailwind CSS | 4.1.18 | v4 stable, zero-config |
| PostgreSQL | 16 | Docker image |
| `@modelcontextprotocol/server-postgres` | 0.6.2 | Deprecated, но достаточно для демо |
| `@modelcontextprotocol/server-github` | 2025.4.8 | Перенесён в github/github-mcp-server |
| `@playwright/mcp` | 0.0.68 | Активно поддерживается |

## Фазы и параллелизация

### Фаза 1: Инфраструктура (параллельно, 3 агента)

Нет зависимостей — все задачи выполняются одновременно.

**Агент A — Docker + ENV:**

- [ ] Создать `docker-compose.yml` (postgres:16, порт 5432, volume)
- [ ] Создать `.env` (DATABASE_URL, POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB)
- [ ] Создать `.env.example` (шаблон без секретов)
- [ ] Добавить `.env` в `.gitignore`

**Агент B — Next.js проект:**

- [ ] Инициализировать Next.js 16 (`create-next-app` с App Router, Tailwind CSS 4, TypeScript)
- [ ] Убедиться, что `package.json` содержит корректные зависимости
- [ ] Проверить что `tsconfig.json`, `next.config.ts` корректны

**Агент C — Prisma схема:**

- [ ] Установить `prisma@7.3.0` и `@prisma/client@7.3.0`
- [ ] Создать `prisma/schema.prisma` со схемой:
  - Модель `User`: id (Int, autoincrement), name, email (unique), createdAt
  - Модель `Todo`: id (Int, autoincrement), title, description (optional), status (enum: PENDING, IN_PROGRESS, DONE), priority (enum: LOW, MEDIUM, HIGH), userId (FK → User), createdAt, updatedAt
  - Enum `TodoStatus`: PENDING, IN_PROGRESS, DONE
  - Enum `TodoPriority`: LOW, MEDIUM, HIGH
- [ ] Создать `prisma/seed.ts`:
  - 3 пользователя (Alice, Bob, Charlie)
  - 12-15 задач с разными статусами/приоритетами
  - "Проблемные" данные: 2 задачи со статусом PENDING но updatedAt > 30 дней назад, 1 задача с пустым description и title "???"
- [ ] Добавить `prisma.seed` в `package.json`

---

### Фаза 2: Инициализация БД (последовательно, 1 агент)

**Зависит от:** Фаза 1 (все три агента).

- [ ] `docker compose up -d` — поднять PostgreSQL
- [ ] `npx prisma migrate dev --name init` — создать миграцию и применить
- [ ] `npx prisma db seed` — заполнить тестовыми данными
- [ ] Проверить, что данные в БД корректны

---

### Фаза 3: Приложение (параллельно, 2 агента)

**Зависит от:** Фаза 2.

**Агент A — API:**

- [ ] Создать `lib/prisma.ts` — singleton Prisma Client
- [ ] `app/api/todos/route.ts`:
  - GET — список задач с фильтрацией по `status` и `priority` (query params), include user
  - POST — создание задачи (title, description, status, priority, userId)
- [ ] `app/api/todos/[id]/route.ts`:
  - PATCH — обновление задачи (любые поля)
  - DELETE — удаление задачи
- [ ] Проверить все эндпоинты через curl

**Агент B — UI:**

- [ ] `app/layout.tsx` — корневой layout с Tailwind, заголовок "Todo App"
- [ ] `app/globals.css` — базовые стили Tailwind
- [ ] `components/TodoForm.tsx` — форма создания задачи (title, description, priority, userId select)
- [ ] `components/TodoItem.tsx` — карточка задачи (заголовок, статус-бейдж, приоритет, кнопки смены статуса и удаления)
- [ ] `components/TodoList.tsx` — список задач с фильтрами по статусу и приоритету
- [ ] `app/page.tsx` — главная страница, объединяет TodoForm и TodoList
- [ ] Проверить UI в браузере: создание, фильтрация, смена статуса, удаление

---

### Фаза 4: MCP и скиллы (параллельно, 2 агента)

**Зависит от:** Фаза 3 (приложение должно работать для проверки скиллов).

**Агент A — MCP-конфигурация:**

- [ ] Создать `.mcp.json`:

```json
{
  "mcpServers": {
    "postgres": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-postgres", "postgresql://todouser:todopass@localhost:5432/tododb"]
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "${GITHUB_TOKEN}"
      }
    },
    "playwright": {
      "command": "npx",
      "args": ["-y", "@playwright/mcp@latest"]
    }
  }
}
```

**Агент B — Скиллы (4 файла параллельно):**

- [ ] `.claude/skills/debug-db/SKILL.md` — сценарии отладки через PostgreSQL MCP:
  - Когда использовать (отладка данных, проверка схемы, поиск аномалий)
  - Примеры запросов и паттерн работы
  - Инструкции: получи контекст → сформулируй SQL → выполни → интерпретируй

- [ ] `.claude/skills/manage-issues/SKILL.md` — управление GitHub Issues:
  - Когда использовать (баг-репорты, трекинг задач, закрытие после фикса)
  - Шаблон issue (заголовок, описание, лейблы, шаги воспроизведения)
  - Примеры: создать, посмотреть список, закрыть с комментарием

- [ ] `.claude/skills/e2e-check/SKILL.md` — проверка UI через Playwright MCP:
  - Когда использовать (визуальная проверка, прохождение сценариев)
  - Паттерн: открой URL → выполни действия → сделай скриншот → проверь результат
  - Примеры сценариев проверки

- [ ] `.claude/skills/full-cycle/SKILL.md` — сквозной сценарий (все 3 MCP):
  - Пошаговый сценарий "задачи пропали"
  - Какой MCP на каком шаге использовать
  - Ожидаемый результат каждого шага

---

### Фаза 5: Документация (1 агент)

**Зависит от:** Фаза 4.

- [ ] Обновить `README.md`:
  - Описание проекта
  - Предварительные требования (Docker, Node.js, GitHub token)
  - Инструкция по запуску (5 шагов)
  - Описание MCP-серверов и как их активировать
  - Список скиллов с кратким описанием каждого
  - Примеры использования для демонстрации на курсе

---

## Граф зависимостей

```
Фаза 1A (Docker)  ──┐
Фаза 1B (Next.js) ──┼──→ Фаза 2 (БД) ──→ Фаза 3A (API)  ──┐
Фаза 1C (Prisma)  ──┘                      Фаза 3B (UI)   ──┼──→ Фаза 4A (MCP config) ──┐
                                                              │    Фаза 4B (Скиллы)      ──┼──→ Фаза 5 (README)
                                                              └────────────────────────────┘
```

## Общее количество агентов

| Фаза | Агентов | Задач |
|---|---|---|
| 1 — Инфраструктура | 3 | 11 |
| 2 — Инициализация БД | 1 | 4 |
| 3 — Приложение | 2 | 11 |
| 4 — MCP и скиллы | 2 | 5 |
| 5 — Документация | 1 | 1 |
| **Итого** | **макс. 3 одновременно** | **32** |
